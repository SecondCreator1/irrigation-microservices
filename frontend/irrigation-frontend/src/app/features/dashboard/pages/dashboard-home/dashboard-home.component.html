<div class="dashboard-container">
  <div class="page-header">
    <div>
      <h1>Tableau de Bord</h1>
      <p class="subtitle">Vue d'ensemble du système d'irrigation</p>
    </div>

    <div class="filters">
      <!-- Select Station -->
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Station Météo</mat-label>
        <mat-select
          [value]="selectedStationId"
          (selectionChange)="onStationChange($event.value)"
        >
          <mat-option *ngFor="let station of stations" [value]="station.id">
            {{ station.nom }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-raised-button color="primary" (click)="refreshDashboard()">
        <mat-icon>refresh</mat-icon>
        Actualiser
      </button>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
  </div>

  <div *ngIf="!isLoading" class="dashboard-content">
    <!-- KPIs Cards -->
    <div class="kpi-grid">
      <mat-card class="kpi-card station-card">
        <mat-card-content>
          <div class="kpi-header">
            <mat-icon class="kpi-icon">place</mat-icon>
            <span class="kpi-label">Stations Météo</span>
          </div>
          <div class="kpi-value">{{ totalStations }}</div>
          <div class="kpi-footer">
            <span class="kpi-trend positive">
              <mat-icon>trending_up</mat-icon>
              Actives
            </span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="kpi-card programme-card">
        <mat-card-content>
          <div class="kpi-header">
            <mat-icon class="kpi-icon">schedule</mat-icon>
            <span class="kpi-label">Total Programmes</span>
          </div>
          <div class="kpi-value">{{ totalProgrammes }}</div>
          <div class="kpi-footer">
            <span class="kpi-info">
              <mat-icon>schedule</mat-icon>
              Planifiés
            </span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="kpi-card active-card">
        <mat-card-content>
          <div class="kpi-header">
            <mat-icon class="kpi-icon">play_circle</mat-icon>
            <span class="kpi-label">Programmes Actifs</span>
          </div>
          <div class="kpi-value">{{ programmesActifs }}</div>
          <div class="kpi-footer">
            <span class="kpi-trend positive">
              <mat-icon>check_circle</mat-icon>
              En cours
            </span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="kpi-card volume-card">
        <mat-card-content>
          <div class="kpi-header">
            <mat-icon class="kpi-icon">water_drop</mat-icon>
            <span class="kpi-label">Volume Prévu</span>
          </div>
          <div class="kpi-value">
            {{ volumeTotalPrevu | number : '1.0-0' }}<span class="unit">L</span>
          </div>
          <div class="kpi-footer">
            <span class="kpi-info">
              <mat-icon>water</mat-icon>
              Total
            </span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
      <!-- Temperature Chart -->
      <mat-card class="chart-card large-chart">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>thermostat</mat-icon>
            Prévisions Météo - Températures
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas
              baseChart
              [data]="temperatureChartData"
              [options]="temperatureChartOptions"
              [type]="'line'"
            >
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Rain Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>water_drop</mat-icon>
            Prévisions de Pluie
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas
              baseChart
              [data]="rainChartData"
              [options]="rainChartOptions"
              [type]="'bar'"
            >
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Status Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>pie_chart</mat-icon>
            Répartition des Programmes
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas
              baseChart
              [data]="statutChartData"
              [options]="statutChartOptions"
              [type]="'doughnut'"
            >
            </canvas>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Quick Actions -->
    <mat-card class="actions-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>touch_app</mat-icon>
          Actions Rapides
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="quick-actions">
          <button mat-raised-button color="primary" routerLink="/meteo/stations">
            <mat-icon>add_location</mat-icon>
            Ajouter une Station
          </button>
          <button mat-raised-button color="primary" routerLink="/meteo/previsions">
            <mat-icon>cloud</mat-icon>
            Voir Prévisions
          </button>
          <button mat-raised-button color="accent" routerLink="/arrosage/programmes">
            <mat-icon>schedule</mat-icon>
            Nouveau Programme
          </button>
          <button mat-raised-button routerLink="/arrosage/journal">
            <mat-icon>history</mat-icon>
            Consulter Journal
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- System Status -->
    <mat-card class="status-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>info</mat-icon>
          État du Système
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="status-list">
          <div class="status-item">
            <mat-icon class="status-icon success">check_circle</mat-icon>
            <div class="status-info">
              <span class="status-title">Microservice Météo</span>
              <span class="status-value">Opérationnel</span>
            </div>
          </div>
          <mat-divider></mat-divider>
          <div class="status-item">
            <mat-icon class="status-icon success">check_circle</mat-icon>
            <div class="status-info">
              <span class="status-title">Microservice Arrosage</span>
              <span class="status-value">Opérationnel</span>
            </div>
          </div>
          <mat-divider></mat-divider>
          <div class="status-item">
            <mat-icon class="status-icon success">check_circle</mat-icon>
            <div class="status-info">
              <span class="status-title">Gateway</span>
              <span class="status-value">Port 9094</span>
            </div>
          </div>
          <mat-divider></mat-divider>
          <div class="status-item">
            <mat-icon class="status-icon success">check_circle</mat-icon>
            <div class="status-info">
              <span class="status-title">RabbitMQ</span>
              <span class="status-value">Connecté</span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
