<h2 mat-dialog-title>{{ isEditMode ? 'Modifier' : 'Créer' }} un programme d'arrosage</h2>

<mat-dialog-content>
  <form [formGroup]="programmeForm">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Numéro de Parcelle</mat-label>
      <input matInput type="number" formControlName="parcelleId" placeholder="Ex: 1">
      <mat-icon matSuffix>landscape</mat-icon>
      <mat-error *ngIf="programmeForm.get('parcelleId')?.hasError('required') && programmeForm.get('parcelleId')?.touched">
        Le numéro de parcelle est requis
      </mat-error>
      <mat-error *ngIf="programmeForm.get('parcelleId')?.hasError('min') && programmeForm.get('parcelleId')?.touched">
        Le numéro de parcelle doit être supérieur ou égal à 1
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Date Planifiée</mat-label>
      <input matInput type="date" formControlName="datePlanifiee">
      <mat-error *ngIf="programmeForm.get('datePlanifiee')?.hasError('required') && programmeForm.get('datePlanifiee')?.touched">
        La date est requise
      </mat-error>
    </mat-form-field>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Durée (minutes)</mat-label>
        <input matInput type="number" formControlName="duree" placeholder="Ex: 60">
        <mat-icon matSuffix>timer</mat-icon>
        <mat-error *ngIf="programmeForm.get('duree')?.hasError('required') && programmeForm.get('duree')?.touched">
          La durée est requise
        </mat-error>
        <mat-error *ngIf="(programmeForm.get('duree')?.hasError('min') || programmeForm.get('duree')?.hasError('max')) && programmeForm.get('duree')?.touched">
          La durée doit être entre 1 et 480 minutes
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Volume Prévu (litres)</mat-label>
        <input matInput type="number" formControlName="volumePrevu" placeholder="Ex: 500">
        <mat-icon matSuffix>water</mat-icon>
        <mat-error *ngIf="programmeForm.get('volumePrevu')?.hasError('required') && programmeForm.get('volumePrevu')?.touched">
          Le volume prévu est requis
        </mat-error>
        <mat-error *ngIf="(programmeForm.get('volumePrevu')?.hasError('min') || programmeForm.get('volumePrevu')?.hasError('max')) && programmeForm.get('volumePrevu')?.touched">
          Le volume doit être entre 1 et 10000 litres
        </mat-error>
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Statut</mat-label>
      <mat-select formControlName="statut">
        <mat-option *ngFor="let statut of statuts" [value]="statut">
          {{ statut }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="programmeForm.get('statut')?.hasError('required') && programmeForm.get('statut')?.touched">
        Le statut est requis
      </mat-error>
    </mat-form-field>

    <div *ngIf="!isEditMode" class="meteo-section">
      <mat-checkbox [(ngModel)]="useMeteo" [ngModelOptions]="{standalone: true}">
        Ajuster selon la météo
      </mat-checkbox>

      <mat-form-field appearance="outline" class="full-width" *ngIf="useMeteo">
        <mat-label>Station Météo</mat-label>
        <mat-select formControlName="stationId">
          <mat-option *ngFor="let station of stations" [value]="station.id">
            {{ station.nom }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="programmeForm.get('stationId')?.hasError('required') && programmeForm.get('stationId')?.touched">
          La station météo est requise lorsque l'ajustement météo est activé
        </mat-error>
      </mat-form-field>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">Annuler</button>
  <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="programmeForm.invalid">
    {{ isEditMode ? 'Modifier' : 'Créer' }}
  </button>
</mat-dialog-actions>
